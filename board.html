<!DOCTYPE html>
<html>
<head>
	<title>BOARD</title>
	<link rel="stylesheet" type="text/css" href="board.css">
</head>
<body>
	<div class="container">
		<div class="board"></div>
		<div class="menu">
			<div class="LEDMenu"></div>
				<button onclick="LEDBoard()">LED</button>
				<button onclick="randomColorLED()">Random color</button>
				<input type="text" value="#" name="colorLED" id="LEDcolor" 
				onkeydown="if (event.keyCode == 13) document.getElementById('changeLEDColor').click()">
	            <button type="button" id="changeLEDColor" onclick="changeLEDColor()">GO</button>
			</div>
			<button onclick="WaveBoard()">Wave Board</button>
			<button onclick="randomBoard()">Random Board</button>
			<button onclick="flipBoard()">Flip Board</button>
			<button onclick="swapBoard()">Swap Board</button>
			<button onclick="clearAll()">Clear All</button>
			<div class="drawMenu">
				<button onclick="drawBoard()">Draw</button>
				<button onclick="saveBoard()">Save</button>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		var colorOnClick = "pink";
		var LEDcolor = "green";
		var isUsingWaveBoard = false;
		var isUsingLEDBoard = false;
		var isUsingRandomBoard = false;
		var isRandomColorLED = false;
		var flipped = [];
		var row = 10;
		var col = 30;
		var shape = [
			//7*15
			[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
			[0,1,0,1,0,1,0,0,0,1,0,1,1,1,0],
			[0,1,0,1,0,1,0,1,0,1,0,1,0,0,0],
			[0,1,1,1,0,1,0,1,0,1,0,1,0,0,0],
			[0,0,1,0,0,1,0,1,0,1,0,1,0,0,0],
			[0,0,1,0,0,1,1,1,1,1,0,1,1,1,0],
			[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
		];

		function createBoard() {
			var ID = "box"; 
			for (var i = 0; i < row; i++) {
				var rowDiv = document.createElement("div");
				ID += i;
				rowDiv.className = "row";
				for (var j = 0; j < col; j++) {
					var boxID = ID + j +"";
					var boxDiv = document.createElement("div");
					boxDiv.className = "box";
					boxDiv.id = boxID;
					rowDiv.appendChild(boxDiv);  
				}
				document.getElementsByClassName("board")[0].appendChild(rowDiv);
				ID = "box";
			}
		}

		//Fix it
		//
		//
		//
		function addClickListener() {
			for (var i = 0; i < row; i++) {
				for (var j = 0; j < col; j++) {
					var box = document.getElementsByClassName("row")[i].childNodes;
					box[j].addEventListener("click", 
						function () {
							alert("You click me");
							// document.getElementById(boxID).style.animation = "flash 1s 1 linear";
					});
				}
			}
		}

		function drawBoard() {

		}

		function saveBoard() {

		}

		function render() {
			for (var i = 0; i < row; i++) {
				for (var j = 0; j < col; j++) {
					var pos = shape[i][j];
					var box = document.getElementsByClassName("row")[i].childNodes;
					if(pos == 1){
						box[j].style.background = "red";
					} else {
						box[j].style.background = "black";
					}

				}
			}
		}

		function LEDBoard() {
			var rowDiv = document.getElementsByClassName("row");
			if(isRandomColorLED) {
				var LEDcolor = getRandomColor();
			}
			if(!isUsingLEDBoard) {
				for (var i = 0; i < row; i++) {
					for (var j = 0; j < col; j++) {
						var pos =shape[i][j];
						if(pos == 1){
							rowDiv[i].childNodes[j].style.background = LEDcolor;
							rowDiv[i].childNodes[j].style.animation = "flash 1.8s infinite linear";
						}

					}
					isUsingLEDBoard = true;
				}
			} else {
				isUsingLEDBoard = false;
				for (var i = 0; i < row; i++) {
					for (var j = 0; j < col; j++) {
						rowDiv[i].childNodes[j].style.animation = "";
					}
				}
			}
			
		}

		function randomColorLED() {
			isRandomColorLED = true;
			isUsingLEDBoard = false;
			LEDBoard();
		}

		function WaveBoard() {
			var rowDiv = document.getElementsByClassName("row");
			if (!isUsingWaveBoard){
				for (var i = 0; i < row; i++) {
				   	for (var j = 0; j < col; j++) {
						(function(i,j) {
							setTimeout(function(){
				       			rowDiv[i].style.animation = "bounce 2s infinite linear";}, (100 * i)
				       		);
				       		setTimeout(function(){
				       			rowDiv[i].childNodes[j].style.animation = "bounce 5s 2 linear";}, (500 * j)
				       		);
				   		})(i,j);
					}
				}
				isUsingWaveBoard = true;
			} else {
				isUsingWaveBoard = false;
				for (var i = 0; i < row; i++) {
				   	for (var j = 0; j < col; j++) {
						rowDiv[i].style.animation = "";
				       	rowDiv[i].childNodes[j].style.animation = "";
					}
				}
			}
		}

		function changeLEDColor(color){
			LEDcolor = document.getElementById('LEDcolor').value;
			isUsingLEDBoard = false;
			LEDBoard();
		}

		function randomBoard() {
			var randomBackground;
			if(!isUsingRandomBoard) {
				var i = 0;
				while (i<=1000) {
					(function(i) {
						randomBackground = setTimeout(
							function(){
				       			var randomRow = Math.floor(Math.random() * row);
								var randomCol = Math.floor(Math.random() * col);
								var rowDiv = document.getElementsByClassName("row");
								if(randomRow != 1 && randomCol != 1) {
									rowDiv[randomRow].childNodes[randomCol].style.background = getRandomColor();
									console.log(randomRow+", "+randomCol);
								}
			       			}, (100 * i)
			       		);
					})(i);
					i++;
				}
				isUsingRandomBoard = true;
			} else {
				isUsingRandomBoard = false;
				var i = 0;
				window.clearTimeout(randomBackground);
			}
		}

		function getRandomColor() {
		    var letters = '0123456789ABCDEF';
		    var color = '#';
		    for (var i = 0; i < 6; i++ ) {
		        color += letters[Math.floor(Math.random() * 16)];
		    }
		    return color;
		}

		function flipBoard() {
			var randomRow = Math.floor(Math.random() * row);
			var randomCol = Math.floor(Math.random() * col);
			flipped = [];
				for(var x = 0; x < row; x++){
				    flipped[x] = [];       
			}
			var sum = recursiveFlipBoard(randomRow, randomCol);
		}

		var flipped = [];
		for(var x = 0; x < row; x++){
		    flipped[x] = [];       
		}
		function recursiveFlipBoard(r, c){
			if(flipped[r][c] == "I") {
				return 0;
			}
			flipped[r][c] = "I";
			var sum = 1;
			var color = getRandomColor();
			var randomColor = color;
			document.getElementsByClassName("row")[r].childNodes[c].style.background = randomColor;
			setTimeout(
				function(){
       				if (r-1>=0) {
						document.getElementsByClassName("row")[r-1].childNodes[c].style.background = randomColor;	
						sum += recursiveFlipBoard(r-1, c);
					}
					if (r+1<=row) {
						document.getElementsByClassName("row")[r+1].childNodes[c].style.background = randomColor;
						sum += recursiveFlipBoard(r+1, c);
					}
					if (c-1>=0) {
						document.getElementsByClassName("row")[r].childNodes[c-1].style.background = randomColor;
						sum += recursiveFlipBoard(r, c-1);
					}
					if (c+1<=col) {
						document.getElementsByClassName("row")[r].childNodes[c+1].style.background = randomColor;
						sum += recursiveFlipBoard(r, c+1);
					}
       			}, (100)
       		);		
			return sum;
		}
		function swapBoard() {
			for (var i = 0; i < shape.length; i++) {
				for (var j = 0; j < shape[0].length; j++) {
					if(shape[i][j] == 0) shape[i][j] = 1;
					else shape[i][j] = 0;
				}
			}
			render();
		}

		function clearAll() {
			isUsingWaveBoard = true;
			isUsingLEDBoard = true;
			WaveBoard();
			LEDBoard();
			render();
		}

		createBoard();
		// addClickListener();
		render();
	</script>
</body>
</html>